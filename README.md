<img width="auto" height="200" alt="77c745c1-a2e7-468e-9bb0-ef8971fed0b3" src="https://github.com/user-attachments/assets/92fb9761-19cd-43fd-afb8-72afecb2a761" />


ðŸš€ A Go service that fetches aircraft data generated by dump1090-fa and streams it to Grafana Loki for real-time monitoring and analysis.

## Prerequisites

- dump1090-fa instance (such as piAware or ADS-B Feeder)
- Grafana Loki instance (Cloud or OSS)

## Demo

You can view live aircraft data from an aerial located in Bristol, UK on our Grafana Dashboard found <a href="https://elfordo.grafana.net/public-dashboards/5faf150d58cd4b818e0b3d98c2d35dfd">here.</a>

## Configuration

Create a `.env` file in the project root with the following variables:

```env
FLIGHT_DATA_URL=http://your-flightdata-instance/data/aircraft.json
LOKI_URL=http://your-loki-instance

# Optional: For Grafana Cloud Logs authentication
GRAFANA_TENANT_ID=your-grafana-tenant-id
GRAFANA_PASSWORD=your-grafana-api-key

# Logging Configuration
LOG_LEVEL=info

# OpenTelemetry Tracing Configuration (Optional)
OTEL_TRACING_ENABLED=true
OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=localhost:4318
OTEL_TRACES_SAMPLER=always_on
```

### Authentication Options

#### No Authentication (Default)
If no authentication environment variables are set, the service will connect without authentication (suitable for local Grafana instances).

#### Grafana Cloud Authentication
For Grafana Cloud, use your Tenant ID and API key:
```env
GRAFANA_TENANT_ID=123456
GRAFANA_PASSWORD=glc_eyJvIjoiNzg5MDkxIiwibiI6InRlc3QiLCJrIjoi...
```

**Note**: 
- The `GRAFANA_TENANT_ID` is your Grafana Cloud Logs Tenant ID
- The `GRAFANA_PASSWORD` is your Grafana Cloud Access Token (not your login password)
- You can find your Logs Tenant ID in your Grafana Cloud Admin Portal
- Create an Access Token in the Grafana Cloud Admin Portal with appropriate permissions of Logs Write

### Logging Configuration

The application uses structured logging in logfmt format with configurable log levels.

#### Log Levels

Set the `LOG_LEVEL` environment variable to control logging verbosity:

- `debug`: Shows all logs including debug calls, environment variables, and HTTP requests
- `info`: Shows info, warn, and error logs (default)
- `warn`: Shows only warning and error logs
- `error`: Shows only error logs

### OpenTelemetry Tracing Configuration

The application supports distributed tracing using OpenTelemetry. This is optional and disabled by default.

#### Environment Variables

- `OTEL_TRACING_ENABLED`: Set to `true` or `1` to enable tracing
- `OTEL_EXPORTER_OTLP_TRACES_ENDPOINT`: OTLP HTTP endpoint for traces (default: `http://localhost:4318/v1/traces`)
- `OTEL_EXPORTER_OTLP_ENDPOINT`: Alternative way to set the endpoint (will append `/v1/traces`)
- `OTEL_EXPORTER_OTLP_TRACES_HEADERS`: Headers for trace export (format: `key1=value1,key2=value2`)
- `OTEL_EXPORTER_OTLP_HEADERS`: Alternative way to set headers
- `OTEL_EXPORTER_OTLP_TRACES_INSECURE`: Set to `true` for insecure connections
- `OTEL_TRACES_SAMPLER`: Sampling strategy (`always_on`, `always_off`, `traceidratio`)

#### Trace Information

When tracing is enabled, the application will create spans for:

- **Main fetch cycle**: Overall operation span (`adsb2loki.fetch_cycle`)
- **HTTP data fetch**: Fetching aircraft data from dump1090-fa (`flightdata.fetch_http`)
- **JSON parsing**: Parsing the aircraft data (`flightdata.parse_json`)
- **Loki operations**: Pushing data to Loki (`flightdata.push_to_loki`, `loki.PushLogs`)
- **HTTP requests**: Individual HTTP requests to Loki (`loki.http_request`)

Each span includes relevant attributes like HTTP status codes, durations, aircraft counts, and error information.

#### Integration with Jaeger

To use with Jaeger (a popular tracing backend):

```bash
# Start Jaeger (all-in-one)
docker run -d --name jaeger \
  -p 16686:16686 \
  -p 14250:14250 \
  -p 14268:14268 \
  -p 4317:4317 \
  -p 4318:4318 \
  jaegertracing/all-in-one:latest

# Configure adsb2loki
export OTEL_TRACING_ENABLED=true
export OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=http://localhost:4318/v1/traces
```

Then view traces at `http://localhost:16686`


## Installation

### Building from Source

1. Clone the repository:
```bash
git clone https://github.com/burnettdev/adsb2loki.git
cd adsb2loki
```

2. Install dependencies:
```bash
go mod tidy
```

3. Build the application:
```bash
go build -o adsb2loki
```

4. Run the application:
```bash
./adsb2loki
```

### Docker

Build and run with Docker:

```bash
# Build the image
docker build -t adsb2loki .

# Run the container
docker run -d \
  --name adsb2loki \
  -e FLIGHT_DATA_URL=http://your-flightdata-instance/data/aircraft.json \
  -e LOKI_URL=http://your-loki-instance \
  -e OTEL_TRACING_ENABLED=true \
  -e OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=http://jaeger:4318/v1/traces \
  --restart unless-stopped \
  adsb2loki
```
Pull from Github Container Registry:

```bash
# Run the container
docker run -d \
  --name adsb2loki \
  -e FLIGHT_DATA_URL=http://your-flightdata-instance/data/aircraft.json \
  -e LOKI_URL=http://your-loki-instance \
  -e OTEL_TRACING_ENABLED=true \
  -e OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=http://jaeger:4318/v1/traces \
  --restart unless-stopped \
  ghcr.io/burnettdev/adsb2loki:latest
```

## Usage

The service will:
- Fetch aircraft data every 5 seconds
- Push the data to Loki with appropriate labels
- Log any errors that occur during the process

## Data Structure

Each aircraft entry in Loki includes:
- Timestamp
- Labels for easy querying
- Full aircraft data as JSON

## Contributing

Feel free to open issues or submit pull requests!

## License

MIT License - feel free to use this project for whatever you'd like!

<img width="auth" height="150" alt="image" src="https://github.com/user-attachments/assets/cbb403e2-7042-42af-8124-422128e146e8" />

ADSB2Loki is proudly part of Snyk's Open Source Programme, ensuring vulnerabilities are found sooner rather than later. You can find more information <a href="https://snyk.io/?utm_source=open-source&utm_medium=pg-ptr&utm_campaign=ref-2501-osp&utm_content=pg-cta">here.</a>

